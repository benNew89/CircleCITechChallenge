# This config was automatically generated from your source code
# Stacks detected: deps:node:.,test:jest:
version: 2.1
orbs:
  node: circleci/node@5
jobs:
  test-node:
    # Install node dependencies and run tests
    machine:
      image: ubuntu-2204:current
    environment:
      JEST_JUNIT_OUTPUT_DIR: ./test-results/
    steps:
      # - checkout
      # - node/install-packages:
      #     cache-path: ~/project/node_modules
      #     override-ci-command: npm install
      # - run:
      #     command: npm install jest-junit
      # - run:
      #     name: Run tests
      #     command: npm run test --ci --runInBand --reporters=default --reporters=jest-junit
      # - store_test_results:
      #     path: ./test-results/
      - run: nvm -v
      - run:
          name: Install NVM
          command: | 
            curl \
            -o- \
            https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh \
            | bash +x
      - run: nvm -v
      - run: echo $NVM_DIR
      - run:
          name: Install node
          command: |
            timeout 180 $SHELL -c '. "${NVM_DIR}/nvm.sh" && nvm install "v20.12.0"' || {
                echo "Failed to install Node.js within the timeout period."
                exit 1
            }
  deploy:
    # This is an example deploy job, not actually used by the workflow
    docker:
      - image: cimg/base:stable
    steps:
      # Replace this with steps to deploy to users
      - run:
          name: deploy
          command: '#e.g. ./deploy.sh'
workflows:
  build-and-test:
    jobs:
      - test-node
    # - deploy:
    #     requires:
    #       - test-node
